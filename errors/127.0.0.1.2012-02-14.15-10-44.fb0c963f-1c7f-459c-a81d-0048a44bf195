(dp1
S'output'
p2
S"<type 'exceptions.KeyError'> 'fields'"
p3
sS'layer'
p4
S'/home/iscott/web/web2py/applications/paideia/controllers/plugin_listandedit.py'
p5
sS'code'
p6
S'# coding: utf8\nif 0:\n    from gluon import current, URL, A\n    from gluon.sqlhtml import SQLFORM\n    response, request, db, session = current.response, current.request, current.db, current.session\n\ndef listing():\n    """\n    API: Takes two required arguments. The first is the name of the \n    table being listed, and the second is the id of the project.\n    Takes one required variable in the URL request: a dictionary with at \n    least one item with the index \'fields\'. The value of \n    request.vars[fields] provides the fields to be used to represent each \n    record in the listing.\n    """\n    response.files.append(URL(\'static\', \n            \'plugin_listandedit/plugin_listandedit.css\'))\n    response.files.append(URL(\'static\', \n            \'plugin_listandedit/plugin_listandedit.js\'))\n\n    tablename = request.args[0]\n    if len(request.args) > 1:\n        restrictor = request.args[1]\n        session.restrictor = restrictor\n        rname_row = db(db.projects.id == restrictor).select().first()\n        rname = rname_row.projectname\n    else:\n        restrictor = None\n        rname = None\n    fieldnames = request.vars[\'fields\']\n\n    rowlist = \'\'\n    if not tablename in db.tables():\n        response.flash = \'\'\'Sorry, you are trying to list \n        entries from a table that does not exist in the database.\'\'\'\n    else:\n        tb = db[tablename]\n        #TODO: Get tables and fields programmatically\n        if restrictor:\n            rowlist = db((tb.author == db.authors.id) & (tb.work == db.works.id) & (tb.project == restrictor)).select()\n        else:\n            rowlist = db(tb.id > 0).select()\n\n    listset = []\n    for r in rowlist:\n        #FIXME: I need to get these values programmatically from vars[\'fields\']\n        listformat = r.fields[1]\n\n        i = A(listformat, _href=URL(\'plugin_listandedit\', \'edit.load\', args=[tablename, r.id]), _class=\'plugin_listandedit_list\', cid=\'viewpane\')\n        listset.append(i)\n\n    adder = A(\'Add new\', _href=URL(\'plugin_listandedit\', \'edit.load\', args=[tablename]), _class=\'plugin_listandedit_list\', cid=\'viewpane\')\n\n    return dict(listset = listset, adder = adder, rname = rname)\n\ndef edit():\n    tablename = request.args[0]\n    if len(request.args) > 1:\n        rowid = request.args[1]\n        formname = \'%s/%s\' % (tablename, rowid)\n\n        #TODO: Set value of "project" field programatically\n        #TODO: Fix widget of "tags" field (adder and multi-select)\n        #TODO: re-load listing component on form submit\n        form = SQLFORM(db[tablename], rowid, separator=\'\', showid=False)\n        if form.process(formname=formname).accepted:\n            response.flash = \'The changes were recorded successfully.\'\n        elif form.errors:\n            print form.vars\n            response.flash = \'Sorry, there was an error processing \' \\\n                             \'the form. The changes have not been recorded.\'\n        else:\n            #TODO: Why is this line being run when a record is first selected?\n            pass\n\n    elif len(request.args) == 1:\n        formname = \'%s/create\' % (tablename)\n\n        form = SQLFORM(db[tablename], separator=\'\', showid=False)\n        if form.process(formname=formname).accepted:\n            arglist = [tablename]\n            if session.restrictor:\n                arglist.append(session.restrictor)\n            the_url = URL(\'plugin_listandedit\', \'listing.load\', args=arglist)\n            response.js = "web2py_component(\'%s\', \'listpane\');" %  the_url\n            response.flash = \'New record successfully created.\'\n        elif form.errors:\n            print form.vars\n            response.flash = \'Sorry, there was an error processing \'\\\n                             \'the form. The new record has not been created.\'\n        else:\n            pass\n\n    else:\n        response.flash = \'Sorry, you need to specify a type of record before I can listing the records.\'\n\n    return dict(form = form)\nresponse._vars=response._caller(listing)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/iscott/web/web2py/gluon/restricted.py", line 204, in restricted\n    exec ccode in environment\n  File "/home/iscott/web/web2py/applications/paideia/controllers/plugin_listandedit.py", line 98, in <module>\n  File "/home/iscott/web/web2py/gluon/globals.py", line 172, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/iscott/web/web2py/applications/paideia/controllers/plugin_listandedit.py", line 47, in listing\n    listformat = r.fields[1]\n  File "/home/iscott/web/web2py/gluon/dal.py", line 4440, in __getattr__\n    return self[key]\n  File "/home/iscott/web/web2py/gluon/dal.py", line 4431, in __getitem__\n    return dict.__getitem__(self, key)\nKeyError: \'fields\'\n'
p11
s.